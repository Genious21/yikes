var spots=Array();var teams=Array();var teamsTurn=0;var numberOfSpots=24;var numberOfBugs=6;var minPoints=1;var maxPoints=12;var retryLimit=200;var circleDiameter=100;var circlePadding=5;function addTeams(e){teams=Array();var b={name:"Red Team",colorClass:"redb",points:0};teams[0]=b;if(e>1){b={name:"Blue Team",colorClass:"blueb",points:0};teams[1]=b}if(e>2){b={name:"Green Team",colorClass:"greenb",points:0};teams[2]=b}if(e>3){b={name:"Yellow Team",colorClass:"yellowb",points:0};teams[3]=b}$("#scoreboard").children(".team").remove();for(var a=0;a<teams.length;a++){var c=document.createElement("div");c.innerHTML="<div class='name'></div><div class='points'>0</div>";c.setAttribute("class","team "+teams[a].colorClass+(a===0?" myturn":""));c.setAttribute("team",a.toString());$(c).children("div.name").first().text(teams[a].name);teams[a].element=c;$("#scoreboard")[0].appendChild(c)}}function isValueInRange(c,b,a){return(c<=a)&&(c>=b)}function isOverlapping(a,e,b){var d=isValueInRange(a.x,e.x-b,e.x+e.width+b)||isValueInRange(e.x,a.x-b,a.x+a.width+b);var c=isValueInRange(a.y,e.y-b,e.y+e.height+b)||isValueInRange(e.y,a.y-b,a.y+a.height+b);return d&&c}function makeSpots(a,n,f){spots=Array();if(a){var c=a.clientHeight-circleDiameter-circlePadding*2;var h=a.clientWidth-circleDiameter-circlePadding*2;var m=0;var b=n+f;for(var g=0;g<b&&m<retryLimit;){var l={};l.x=Math.floor(Math.random()*(h));l.y=Math.floor(Math.random()*(c));l.width=circleDiameter+circlePadding;l.height=l.width;l.points=Math.floor(Math.random()*maxPoints)+minPoints;var o=(l.x+l.width>$("#scoreboard")[0].offsetLeft&&l.y-l.height<$("#scoreboard")[0].offsetTop+$("#scoreboard")[0].offsetHeight);for(var e=0;e<g&&!o;e++){o=isOverlapping(l,spots[e],10)}if(o){m++;continue}m=0;spots[g]=l;g++}for(var e=0;e<f&&e<g;e++){spots[e].points=0}if(m>=retryLimit){$("#info").text(g.toString()+"/"+e.toString())}$(".spot").remove();for(var e=0;e<g;e++){var k=document.createElement("div");k.className="spot "+(spots[e].points==0?"bug":"");k.style.top=spots[e].y.toString()+"px";k.style.left=spots[e].x.toString()+"px";k.innerHTML="<div class='front shadow'></div><div class='back shadow'><span>"+spots[e].points.toString()+"</span></div>";k.setAttribute("spot",e.toString());a.appendChild(k);spots[e].element=k}}}function indicateWinningTeam(){var c=-1;var a=0;for(var b=0;b<teams.length;b++){if(teams[b].points>=a){c=b;a=teams[b].points}}if(c!=-1&&a>0){$(".watermark").attr("class","watermark "+teams[c].colorClass.substring(0,teams[c].colorClass.length-1))}else{$(".watermark").attr("class","watermark")}}function startGame(){teamsTurn=0;addTeams($("#fldTeams").val());makeSpots($("#farm")[0],parseInt($("#fldSpots").val()),parseInt($("#fldBugs").val()));$(".spot").toggle(function(){$(this).addClass("flip");$(this).children(".back").first().addClass(teams[teamsTurn].colorClass);$(this).attr("team",teamsTurn.toString());var a=spots[parseInt($(this).attr("spot"))].points;if(a===0){$(this).addClass("bug");teams[teamsTurn].points=0;$(teams[teamsTurn].element).children("div.points").first().text(teams[teamsTurn].points.toString());$(teams[teamsTurn].element).removeClass("myturn");teamsTurn++;if(teamsTurn>=teams.length){teamsTurn=0}$(teams[teamsTurn].element).addClass("myturn")}else{teams[teamsTurn].points+=a;$(teams[teamsTurn].element).children("div.points").first().text(teams[teamsTurn].points.toString())}indicateWinningTeam()},function(){if(confirm("Are you sure you want to undo this move?")){$(this).removeClass("flip");$(this).children(".back").first().removeClass(teams[parseInt($(this).attr("team"))].colorClass);var a=parseInt($(this).attr("team"));teams[a].points-=spots[parseInt($(this).attr("spot"))].points;if(teams[a].points<0){teams[a].points=0}$(teams[a].element).children("div.points").first().text(teams[a].points.toString());indicateWinningTeam()}});$(".team").click(function(){$(teams[teamsTurn].element).removeClass("myturn");teamsTurn=parseInt($(this).attr("team"));$(teams[teamsTurn].element).addClass("myturn")})}$(document).ready(function(){$("#setup button").click(startGame)});